{
  "hash": "1007679c3f642a5994792d96f7cbc32d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"SQL: Hungry Cop Effect\"\ndescription: |\n  Is there a pattern in the outcome of traffic stops based on whether they're after lunch?\nauthor: Nikhil Shah\ndate: April 22, 2025\nformat: html\n---\n\n\n\n## Introduction\n\nIt's been observed that judges are less likely to grant lenient sentences or parole when they are hungry. (i.e. before their lunch break) (Danziger et al., 2011). This has become known as the \"hungry judge effect\".\n\nWe can use data from the Stanford Open Policing Project (Pierson et al., 2020) to observe the rate at which traffic stops result in citations, and whether there's a meaningful difference in this rate before and after noon (which, presumably, is roughly when cops would eat lunch and be the hungriest). Washington, Texas, and New Jersey all give data for citations given and time of day. \n\nI cut off the data according to the normal 9-5 work day. While traffic stops obviously happen outside of those hours, it doesn't make sense to evaluate the effect of a lunch break on something happening in the middle of the night.\n\n## Data\n\n### Libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RMariaDB)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n### SQL Connection\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncon_traffic <- DBI::dbConnect(\n  RMariaDB::MariaDB(),\n  dbname = \"traffic\",\n  host = Sys.getenv(\"TRAFFIC_HOST\"),\n  user = Sys.getenv(\"TRAFFIC_USER\"),\n  password = Sys.getenv(\"TRAFFIC_PWD\")\n)\n```\n:::\n\n\n\n### Query\n\n\n\n::: {.cell output.var='citations_and_warnings'}\n\n```{.sql .cell-code}\nSELECT 'WA' AS state,\n       CASE\n        WHEN time < '12:00:00' THEN 'morning'\n        ELSE 'afternoon'\n       END AS day_segment,\n       AVG(citation_issued) AS citation_rate,\n       AVG(warning_issued) AS warning_rate\nFROM wa_statewide_2020_04_01\nWHERE time > '09:00:00' AND time < '17:00:00'\nGROUP BY day_segment\n\nUNION ALL\n\nSELECT 'TX' AS state,\n       CASE\n        WHEN time < '12:00:00' THEN 'morning'\n        ELSE 'afternoon'\n       END AS day_segment,\n       AVG(citation_issued) AS citation_rate,\n       AVG(warning_issued) AS warning_rate\nFROM tx_statewide_2020_04_01\nWHERE time > '09:00:00' AND time < '17:00:00'\nGROUP BY day_segment\n\nUNION ALL\n\nSELECT 'NJ' AS state,\n       CASE\n        WHEN time < '12:00:00' THEN 'morning'\n        ELSE 'afternoon'\n       END AS day_segment,\n       AVG(citation_issued) AS citation_rate,\n       AVG(warning_issued) AS warning_rate\nFROM nj_statewide_2020_04_01\nWHERE time > '09:00:00' AND time < '17:00:00'\nGROUP BY day_segment;\n```\n:::\n\n\n\n# This takes the overall data for a state, filters out times outside of the normal workday, adds a column that specifies what part of the day a stop occurred at based on the time, and splits the table into two parts for each part of the day. It averages the column \"citation_issued\", which is 1s for yes and 0s for no, to get the rate at which citations were issued at each part of the day. It combines this output for three different states into one table.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncitations_and_warnings\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  state day_segment citation_rate warning_rate\n1    WA   afternoon     0.3797482    0.4209331\n2    WA     morning     0.4442537    0.4271534\n3    TX   afternoon     0.3883023    0.7490462\n4    TX     morning     0.3767222    0.7539040\n5    NJ   afternoon     0.6136698    0.4608858\n6    NJ     morning     0.6276607    0.4499691\n```\n\n\n:::\n:::\n\n\nThe final data from the SQL query shows one row for each pairing of state and part of the day, and the proportion of traffic stops resulting in a citation or a warning in each. \n\n## Visualization\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncitations_and_warnings |>\n  ggplot() +\n  geom_col(\n    aes(x = state, y = citation_rate, fill = day_segment),\n    position = 'dodge'\n  ) +\n  labs(\n    x = 'State',\n    fill = 'Part of Day',\n    y = 'Citation Rate',\n    title = 'Frequency of Citations from Traffic Stops at Different Times of Day'\n  )\n```\n\n::: {.cell-output-display}\n![](project5_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncitations_and_warnings |>\n  ggplot() +\n  geom_col(\n    aes(x = state, y = warning_rate, fill = day_segment),\n    position = 'dodge') +\n  labs(\n    x = 'State',\n    fill = 'Part of Day',\n    y = 'Warning Rate',\n    title = 'Frequency of Warnings from Traffic Stops at Different Times of Day'\n  )\n```\n\n::: {.cell-output-display}\n![](project5_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\n\n\n## Interpretation\n\nThe answer seems to be a solid no. While 44% of morning traffic stops in Washington state result in citations, compared to 38% of afternoon ones, this pattern doesn't exist in the other two states. The rate at which warnings are given is identical.\n\nNotably, without the time constraint, the morning citation rates are considerably higher than the afternoon ones for all three states. I assume this is because \"morning\" encompasses late-night traffic stops, which evidently result in much more citations. This proves that removing those parts of the data makes sense, because, as stated earlier, a DUI citation at 3 am probably doesn't have any degree of dependence on whether the officer has had lunch yet.\n\nOverall, the null hypothesis seems to be supported in this case. Big states like California and New Jersey do not supply time of citation information, so it may be helpful to collect more data to confirm these findings.\n\n\n## References\n\n * Danziger, Shal, Jonathan Levav, Liora Avnaim-Pesso. 2011. \"Extraneous Factors in Judicial Decisions.\" *Proc. Natl. Acad. Sci. U.S.A.*, 108 (17) 6889-6892.\n\n * Pierson, Emma, Camelia Simoiu, Jan Overgoor, Sam Corbett-Davies, Daniel Jenson, Amy Shoemaker, Vignesh Ramachandran, et al. 2020. “A Large-Scale Analysis of Racial Disparities in Police Stops Across the United States.” *Nature Human Behaviour*, 1–10.\n\n\n",
    "supporting": [
      "project5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}